{% extends "base_layout.html" %}
{% block content %}
<div class="card">
  <div class="card-body">

    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3>View Members</h3>

      <div>
        <form method="get" action="{{ url_for('view_members') }}" class="d-flex">
          <input type="text" name="search" class="form-control form-control-sm me-2"
                 placeholder="Search by name or mobile" value="{{ search_query }}">
          <button type="submit" class="btn btn-sm btn-primary">Search</button>
          {% if search_query %}
            <a href="{{ url_for('view_members') }}" class="btn btn-sm btn-secondary ms-2">Clear</a>
          {% endif %}
        </form>
      </div>

      <a href="{{ url_for('add_member') }}" class="btn btn-success btn-sm">+ Add Member</a>
    </div>

    <!-- ⭐ NEW BUTTONS -->
<!-- ⭐ NEW BUTTONS -->
<div class="mb-3 d-flex gap-2">

    <!-- Send WhatsApp Image Reminder -->
    <a href="{{ url_for('send_reminder_images') }}" class="btn btn-warning">
        Send WhatsApp Image Reminders
    </a>

    <!-- Generate Images -->
    <a href="{{ url_for('generate_all_images') }}" class="btn btn-primary">
        Generate Images (Expiring Soon)
    </a>

</div>
<!-- ⭐ END NEW BUTTONS -->

    <!-- ⭐ END NEW BUTTONS -->

    <div class="table-responsive mt-3">
      <table class="table table-striped align-middle">
        <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Mobile</th>
            <th>Plan</th>
            <th>Package</th>
            <th>Joined</th>
            <th>End</th>
            <th>Days Left</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody>
          {% if members %}
            {% for m in members %}
            <tr>
              <td>{{ loop.index }}</td>
              <td>{{ m.name }}</td>
              <td>{{ m.mobile }}</td>
              <td>{{ m.plan }}</td>
              <td>{{ m.package }}</td>
              <td>{{ m.joined_date }}</td>
              <td>{{ m.end_date }}</td>

              <td>
                {% if m.days_left <= 0 %}
                  <span class="badge bg-danger">Expired</span>
                {% elif m.days_left <= 3 %}
                  <span class="badge bg-warning">{{ m.days_left }} days</span>
                {% else %}
                  <span class="badge bg-success">{{ m.days_left }} days</span>
                {% endif %}
              </td>

              <td class="text-nowrap">
                <div class="d-flex gap-2">
                  <a href="{{ url_for('edit_member', member_id=m.id) }}" class="btn btn-sm btn-primary">
                    Edit
                  </a>

                  <a href="{{ url_for('delete_member', member_id=m.id) }}" 
                     class="btn btn-sm btn-danger"
                     onclick="return confirm('Are you sure you want to delete this member?');">
                    Delete
                  </a>

                  <a href="{{ url_for('renew_member', id=m.id) }}" class="btn btn-sm btn-success">
                    Renew
                  </a>
                </div>
              </td>

            </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="9" class="text-center text-muted">No members found.</td>
            </tr>
          {% endif %}
        </tbody>

      </table>
    </div>
  </div>
</div>
{% endblock %}
